(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{8355:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/modelverify",function(){return i(2382)}])},2382:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return s}});var r=i(5893),o=i(9034),n=i.n(o),a=i(2698);function s(){let t="".concat("https://techlauncher-mlai-edge-physics.github.io","/pvf_incomp_44.json"),e=t=>{console.log(t)};return a.Z.createModelService("../_next/static/chunks/pages/model/bno_small.onnx",[64,64],10).then(i=>{i.bindOutput(e),i.initMatrixFromPath(t).then(()=>{i.startSimulation()})}),(0,r.jsxs)("div",{className:n().scene,children:[(0,r.jsx)("h1",{className:n().title,children:"Model Verification"}),(0,r.jsxs)("div",{className:n().description,children:[(0,r.jsx)("p",{children:" simulation draft "}),(0,r.jsx)("p",{children:" Get started by opening console"})]})]})}},2698:function(t,e,i){"use strict";i.d(e,{Z:function(){return o}});var r=i(8736);class o{static async createModelService(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[64,64],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;console.log("createModelService called");let r=new o;return console.log("createModelService constructor called"),await r.init(t,e,i),console.log("createModelService finished"),r}async initMatrixFromPath(t){"/"===t[0]&&(t="".concat("https://techlauncher-mlai-edge-physics.github.io","/").concat(t)),console.log("initMatrixFromPath called with path: ".concat(t));let e=await fetch(t).then(async t=>await t.json());if(null==e)throw Error("The matrix from ".concat(t," is null"));this.initMatrixFromJSON(e)}bindOutput(t){this.outputCallback=t}async startSimulation(){await this.iterate()}pauseSimulation(){this.continueSimulation=!1}async init(t,e,i){console.log("init called"),this.session=await r.InferenceSession.create(t,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("init session created"),this.gridSize=e,this.batchSize=i,this.tensorShape=[i,e[0],e[1],5],this.tensorSize=i*e[0]*e[1]*5}initMatrixFromJSON(t){if(console.log("initMatrixFromJSON called"),this.matrixArray=new Float32Array(t.flat(1/0)),this.matrixArray.length!==this.tensorSize)throw Error("matrixArray length ".concat(this.matrixArray.length," does not match tensorSize ").concat(this.tensorSize))}async iterate(){if(null==this.session)throw Error("session is null, createModelServices() must be called at first");console.log("iterate called"),console.log("this.matrixArray",this.matrixArray);let t=new r.Tensor("float32",this.matrixArray,this.tensorShape),e={};e[this.session.inputNames[0]]=t;try{let t=await this.session.run(e);t.Output.data instanceof Float32Array&&(this.outputCallback(t.Output.data),this.copyOutputToMatrix(t.Output.data),this.continueSimulation&&this.iterate())}catch(t){console.error("error in session.run",t)}}copyOutputToMatrix(t){if(0===this.matrixArray.length)throw Error("matrixArray is empty");let e=0,i=0,r=0;for(;e<t.length;){if(r>=3&&(r=0,(i+=2)>=this.matrixArray.length))throw Error("toIndex ".concat(i," exceeds matrixArray length ").concat(this.matrixArray.length));this.matrixArray[i]=t[e],e++,i++,r++}if(e!==t.length)throw Error("fromIndex ".concat(e," does not match outputs length ").concat(t.length));if(i+2!==this.matrixArray.length)throw Error("toIndex ".concat(i," does not match matrixArray length ").concat(this.matrixArray.length))}updateForce(t,e){let i=this.getIndex(t);this.matrixArray[i+3]+=e.x,this.matrixArray[i+4]+=e.y}getIndex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e*this.gridSize[0]*this.gridSize[1]+t.y*this.gridSize[0]+t.x}constructor(){this.session=null,this.matrixArray=new Float32Array,this.gridSize=[0,0],this.batchSize=0,this.tensorShape=[0,0,0,0],this.tensorSize=0,this.continueSimulation=!0}}},9034:function(t){t.exports={main:"Home_main__nLjiQ",description:"Home_description__41Owk",code:"Home_code__suPER",grid:"Home_grid__GxQ85",card:"Home_card___LpL1",center:"Home_center__4BFgC",logo:"Home_logo__27_tb",thirteen:"Home_thirteen__cMI_k",rotate:"Home_rotate____XsI",content:"Home_content__Zy02X",vercelLogo:"Home_vercelLogo__dtSk9",scene:"Home_scene__X8N8q",canvas:"Home_canvas__x616u",body:"Home_body__XYSzx"}}},function(t){t.O(0,[774,770,240,888,179],function(){return t(t.s=8355)}),_N_E=t.O()}]);