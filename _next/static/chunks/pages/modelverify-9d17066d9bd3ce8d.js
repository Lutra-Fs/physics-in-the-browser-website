(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{8355:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/modelverify",function(){return i(2382)}])},2382:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return d}});var o=i(5893),r=i(9477),n=i(9034),a=i.n(n),s=i(5078),c=i(5029),l=i(4737),h=i(7294),u=i(2698);function m(t){let e=(0,h.useRef)(null),i=new r.BufferAttribute(new Float32Array([1,0,0,1,1,1,1,1,1,0,0,1]),3);return(0,s.A)(t=>{t.camera.setRotationFromAxisAngle(new r.Vector3(1,0,0),-Math.PI/2),e.current.lookAt(0,99,0),e.current.geometry.setAttribute("aColor",i)}),(0,o.jsxs)("mesh",{...t,ref:e,children:[(0,o.jsx)("planeGeometry",{args:[2,2,1,1]}),(0,o.jsx)("shaderMaterial",{vertexShader:"\nattribute vec3 aColor;\nvarying lowp vec4 vColor;\n\nvoid main(void) {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  vColor = vec4(aColor, 1.0);\n}\n",fragmentShader:"\nvarying lowp vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"})]})}function d(){let t="".concat("http://localhost:8000","/pvf_incomp_44.json"),e=t=>{console.log(t)};return u.Z.createModelService("../_next/static/chunks/pages/model/bno_small.onnx",[64,64],10).then(i=>{i.bindOutput(e),i.initMatrixFromPath(t).then(()=>{i.startSimulation()})}),(0,o.jsx)("div",{className:a().scene,children:(0,o.jsxs)(c.Xz,{shadows:!0,className:a().canvas,camera:{position:[1,10,1]},children:[(0,o.jsx)("ambientLight",{}),(0,o.jsx)(m,{position:[0,0,0]}),(0,o.jsx)(l.o,{})]})})}},2698:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});var o=i(8736);class r{static async createModelService(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[64,64],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;console.log("createModelService called");let o=new r;return console.log("createModelService constructor called"),await o.init(t,e,i),console.log("createModelService finished"),o}async initMatrixFromPath(t){"/"===t[0]&&(t="".concat("http://localhost:8000","/").concat(t)),console.log("initMatrixFromPath called with path: ".concat(t)),this.initMatrixFromJSON(await fetch(t).then(async t=>await t.json()))}bindOutput(t){this.outputCallback=t}async startSimulation(){await this.iterate()}pauseSimulation(){this.continueSimulation=!1}async init(t,e,i){console.log("init called"),this.session=await o.InferenceSession.create(t,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("init session created"),this.gridSize=e,this.batchSize=i,this.tensorShape=[i,e[0],e[1],5],this.tensorSize=i*e[0]*e[1]*5}initMatrixFromJSON(t){if(console.log("initMatrixFromJSON called"),this.matrixArray=new Float32Array(t.flat(1/0)),this.matrixArray.length!==this.tensorSize)throw Error("matrixArray length ".concat(this.matrixArray.length," does not match tensorSize ").concat(this.tensorSize))}async iterate(){if(null==this.session)throw Error("session is null, createModelServices() must be called at first");console.log("iterate called"),console.log("this.matrixArray",this.matrixArray);let t=new o.Tensor("float32",this.matrixArray,this.tensorShape),e={};e[this.session.inputNames[0]]=t,this.session.run(e).then(t=>{t.Output.data instanceof Float32Array&&(this.outputCallback(t.Output.data),this.copyOutputToMatrix(t.Output.data),this.continueSimulation&&this.iterate())}).catch(t=>{console.error("error in session.run",t)})}copyOutputToMatrix(t){if(0===this.matrixArray.length)throw Error("matrixArray is empty");let e=0,i=0,o=0;for(;e<t.length;)o>=3&&(o=0,i+=2),this.matrixArray[i]=t[e],e++,i++,o++;if(i+2!==this.matrixArray.length)throw Error("toIndex ".concat(i," does not match matrixArray length ").concat(this.matrixArray.length))}updateForce(t,e){let i=this.getIndex(t);this.matrixArray[i+3]+=e.x,this.matrixArray[i+4]+=e.y}getIndex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e*this.gridSize[0]*this.gridSize[1]+t.y*this.gridSize[0]+t.x}constructor(){this.session=null,this.matrixArray=new Float32Array,this.gridSize=[0,0],this.batchSize=0,this.tensorShape=[0,0,0,0],this.tensorSize=0,this.continueSimulation=!0}}},9034:function(t){t.exports={main:"Home_main__nLjiQ",description:"Home_description__41Owk",code:"Home_code__suPER",grid:"Home_grid__GxQ85",card:"Home_card___LpL1",center:"Home_center__4BFgC",logo:"Home_logo__27_tb",thirteen:"Home_thirteen__cMI_k",rotate:"Home_rotate____XsI",content:"Home_content__Zy02X",vercelLogo:"Home_vercelLogo__dtSk9",scene:"Home_scene__X8N8q",canvas:"Home_canvas__x616u",body:"Home_body__XYSzx"}}},function(t){t.O(0,[774,737,770,422,888,179],function(){return t(t.s=8355)}),_N_E=t.O()}]);